<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>0921</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>       

    <%- include('./nav_c50.html') %>  
   
    <h1 class="title-page">./views/list.ejs</h1>

      <br><br>


        <p>c66 ê°„ë‹¨ search</p>
        <input type="text" id="search-input">
        <button id="search" class="myBtn">search</button>
      </div>
      
   
      <br>
      <section>
          <h2>ğŸ€c32. ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ í• ì¼ ë¦¬ìŠ¤íŠ¸</h2>
  
          <!-- ğŸ€c34 -->
          <h4>í• ì¼ ì œëª© : <%= ig_posts[0].title %></h4>
          <p>í• ì¼ ë§ˆê°ë‚ ì§œ : <%= ig_posts[0].date %></p>
          
          <br><br>
          <h2>ğŸ€c34 ë°˜ë³µë¬¸, ğŸ€reverse.forEach </h2>

          <!-- ğŸ¦„c34. ğŸ€reverse.forEachì ìš©í•˜ê¸° -->
          
          <% ig_posts.slice().reverse().forEach(function(item) {     %>  
            <div class="list">
              <h2>id: <%= item._id %></h2>
              <h2>í• ì¼ ì œëª© : <%= item.title %></h2>
              <p>í• ì¼ ë§ˆê°ë‚ ì§œ : <%= item.date %></p> 
              
              <!-- ğŸ€c42 -->
              <button class="myBtn delete" data-id="<%= item._id %>">Delete</button>
              
              <button class="myBtn delete_c72" data-id="<%= item._id %>">delete_c72</button>
      
              <!-- ğŸ€c48 href="http://localhost:3000/detail/<%= item._id %>"-->
              
              <a class="myBtn detail"  data-id="<%= item._id %>" href="/detail/<%= item._id %>">Detail page</a>              
            </div>
          <%  })  %>  
          
    

        

      </section>

<!-- ğŸ¦„ğŸ¦„c42,44,46, AJAXë¡œ DELETE ìš”ì²­í•˜ê¸° -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>

  // ğŸ¦„c41
    $('.delete').click((e)=>{           

        // ğŸ€44
        $.ajax({
          method: "DELETE",
          url: "/delete",
          data: {_id: e.target.dataset.id}
          
        }).done(function() {
          
          $(this).parent('div').fadeOut();
          location.reload();
        
          console.log('ig delete success - list.js')
        }).fail(function (jqXHR, textStatus) {                  //ğŸ‘‰c46-40)

        console.log('c44, delete-fail')
        console.log( "Request failed: " + textStatus );   
        });
    });


    // ğŸ¦„c72
    $('.delete').click((e)=>{
        $.ajax({
          method: "DELETE",
          url: "/delete_c72",
          data: {_id: e.target.dataset.id}
          
        }).done(function() {
          
          $(this).parent('div').fadeOut();
          location.reload();

          console.log('ig delete success - list.js')
        }).fail(function (jqXHR, textStatus) {                  

        console.log('c44, delete-fail')
        console.log( "Request failed: " + textStatus );   
        });
     });
    


    //ğŸ¦„ğŸ¦„c66
    //ğŸ€c66-10). searchê¸°ëŠ¥ ë§Œë“¤ê¸°, query string ë§Œë“¬ (Query string parameters)

    // ğŸ‰
      $('#search').click(function () {          
          var ig_search_inputê°’ = $('#search-input').val()

          window.location.replace(`/search_c68?value=${ig_search_inputê°’}`)        
      })
  </script>
</body>
</html>